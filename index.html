<!DOCTYPE html>
<html>
<head>

	<!-- Access jQuery Library -->
	<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<link href='https://fonts.googleapis.com/css?family=Josefin+Slab:700' rel='stylesheet' type='text/css'>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	<!-- CartoDB -->
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
	<script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>

	<style>
		html, body {width:100%; height:100%; padding: 0; margin: 0;}
		#cartodb-map { width: 100%; height:100%; background: black;}
	</style>



   <script type="infowindow/html" id="infowindow_template">
      <span> custom </span>
      <div class="cartodb-popup">
        <a href="#close" class="cartodb-popup-close-button close">x</a>
         <div class="cartodb-popup-content-wrapper">
           <div class="cartodb-popup-content">
             <img style="width: 100%" src="http://rambo.webcindario.com/images/18447755.jpg">
             <!-- content.data contains the field info -->
             <h4>{{content.data.name}}</h4>
           </div>
         </div>
         <div class="cartodb-popup-tip-container"></div>
      </div>
    </script>

<script>

/*

	Default parameters

*/
var UD = {};
UD.map;
UD.PercentPoverty1990 = "https://uducla.cartodb.com/api/v2/viz/8ed490f2-d69c-11e5-ae04-0ecd1babdde5/viz.json";
UD.PercentPoverty2000 = "https://uducla.cartodb.com/api/v2/viz/a25dc53a-d69c-11e5-8997-0e674067d321/viz.json";
UD.PercentPoverty2013 = "https://uducla.cartodb.com/api/v2/viz/b7066442-d69c-11e5-b7ec-0ecfd53eb7d3/viz.json";
UD.Population1990 = "https://uducla.cartodb.com/api/v2/viz/d2a7a954-d69c-11e5-a3bd-0ecfd53eb7d3/viz.json";
UD.Population2000 = "https://uducla.cartodb.com/api/v2/viz/e4e44028-d69c-11e5-9e13-0ecfd53eb7d3/viz.json";
UD.Population2013 = "https://uducla.cartodb.com/api/v2/viz/f744ae74-d69c-11e5-acdb-0e31c9be1b51/viz.json";

/*

	On document load

*/
$( document ).ready(function() {
	UD.init();

	$(".dropdown-menu li a").click(function(){
		var selText = $(this).text();
		var param = $(this).attr('title');
		$(this).parents('.btn-group').find('.dropdown-toggle').html(selText+' <span class="caret"></span>');
		UD.addLayer(param);
	});

	$(".year").click(function(){
		var year = $(this).text();
		$('.year').removeClass('btn-info');
		$(this).addClass('btn-info');
		UD.addLayer(UD.param,year);
	});
});

/*

	Begin mapping

*/
UD.init = function()
{	
	var mapOptions = {
		center: [34.243594729697406, -118.2073974609375],
		zoom: 9
	};
	UD.map = new L.Map('cartodb-map', mapOptions);

	var baselayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
	  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
	});
	UD.map.addLayer(baselayer);
}

UD.addLayer = function(param,year)
{
	// hide existing layer
	if(UD.layer) UD.layer.hide();

	// defaults
	if(param == undefined)
	{
		UD.param = 'PercentPoverty';
	} 
	else
	{
		UD.param = param;
	}
	if(year == undefined)
	{
		UD.year = 1990;
	} 
	else
	{
		UD.year = year;
	}

	// add layer
	cartodb.createLayer(UD.map, UD[UD.param+UD.year],{tooltip:false})
		.addTo(UD.map)
		.on('done', function(layer) {
			UD.layer = layer;
			layer
			.on('featureOver', function(e, latlng, pos, data) {
				console.log(data);
			})
			.on('error', function(err) {
				console.log('error: ' + err);
			});

			// get sublayer 0 and set the infowindow template
			var sublayer = layer.getSubLayer(0);
			// sublayer.infowindow.set('template', $('#infowindow_template').html());

			// layer.leafletMap.viz.addOverlay({
			// 	type: 'tooltip',
			// 	layer: sublayer,
			// 	template: '<div class="well cartodb-tooltip-content-wrapper"><p>1990: {{pct_pov90}}<br>2000: {{pct_pov00}}<br>2013: {{pct_pov13}}</p></div>', 
			// 	// template: '<div class="cartodb-tooltip-content-wrapper"><img style="width: 100%" src={{_url}}>{{name}}, {{age}}, {{city}}, {{country}}</div>', 
			// 	position: 'top|right',
			// 	fields: [{ name: 'name' }]
			// });

			// layer.leafletMap.viz.addOverlay({
			// 	type: 'infobox',
			// 	layer: sublayer,
			// 	template: '<p>1990: {{pct_pov90}}<br>2000: {{pct_pov00}}<br>2013: {{pct_pov13}}<br></p>',
			// 	width: 200, // width of the box
			// 	position: 'bottom|left' // top, bottom, left and right are available
			// });

		}).on('error', function(err) {
		console.log("some error occurred: " + err);
	});
}


  </script>
</head>

<body>
	<div id='cartodb-map'></div>
	<div style="position:absolute;top:10px;right:10px">
		<div class="btn-group" role="group" aria-label="...">
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Choose parameter to map
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li><a href="#" title="Population">Population</a></li>
					<li><a href="#" title="PercentPoverty">Percent Poverty</a></li>
				</ul>
			</div>
			<button type="button" class="year btn btn-default">1990</button>
			<button type="button" class="year btn btn-default">2000</button>
			<button type="button" class="year btn btn-default">2013</button>
		</div>
	</div>
</body>
</html>
